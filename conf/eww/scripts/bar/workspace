#!/usr/bin/env bash

# Build and push the new workspace-markup into Eww.
update_workspaces() {
  # grab the list of workspaces as JSON
  local ws_json
  ws_json="$(hyprctl workspaces -j)"   # JSON array of { id, name, focused, … }

  # build each button
  local buttons=""
  # for each workspace object
  while read -r id focused; do
    # pick an icon based on focused-state
    if [[ "$focused" == "true" ]]; then
      icon=""
    else
      icon=""
    fi
    buttons+="(button :onclick \"hyprctl dispatch workspace $id\" \
                     :class \"workspace_button\" \
                     \"$icon\") "
  done < <(
    # emit "id focused" per line
    echo "$ws_json" \
      | jq -r '.[] | "\(.id) \(.focused)"'
  )

  # wrap in a box
  local ws_box="(box :class \"workspaces\" \
                       :orientation \"h\" \
                       :spacing 5 \
                       :space-evenly \"false\" \
                       $buttons)"

  # tell Eww to update the `workspace` variable
  eww update workspace="$ws_box"
}

notify-send "Workspace call"
update_workspaces
